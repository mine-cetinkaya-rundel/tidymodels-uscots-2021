<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>Tidy up your models</title>
    <meta charset="utf-8" />
    <meta name="author" content=" Mine √áetinkaya-Rundel and Debbie Yuster" />
    <script src="libs/header-attrs-2.9/header-attrs.js"></script>
    <link href="libs/panelset-0.2.6/panelset.css" rel="stylesheet" />
    <script src="libs/panelset-0.2.6/panelset.js"></script>
    <link rel="stylesheet" href="xaringan-themer.css" type="text/css" />
    <link rel="stylesheet" href="slides.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

# Tidy up your models
## <br>üîó <a href="https://bit.ly/tidymodels-uscots21/">bit.ly/tidymodels-uscots21</a>
### <br>Mine √áetinkaya-Rundel and Debbie Yuster
### USCOTS 2021

---




layout: true
  
&lt;div class="my-footer"&gt;
&lt;span&gt;
&lt;a href="https://bit.ly/tidymodels-uscots21" target="_blank"&gt;bit.ly/tidymodels-uscots21&lt;/a&gt;
&lt;/span&gt;
&lt;/div&gt; 

---



class: middle, inverse

## .larger[.dark-blue[.hand[Welcome]]]

---

class: middle

&lt;img src="images/logo.png" width="50%" style="display: block; margin: auto;" /&gt;

.center[
.large[
One link for all materials

üîó [bit.ly/tidymodels-uscots21](https://bit.ly/tidymodels-uscots21)
]]

---

.center[
.pull-left[
&lt;img src="images/mine.png" width="60%" style="display: block; margin: auto;" /&gt;
Mine √áetinkaya-Rundel &lt;br&gt;
Duke University, RStudio
]
.pull-right[
&lt;img src="images/debbie.png" width="60%" style="display: block; margin: auto;" /&gt;
Debbie Yuster &lt;br&gt;
Ramapo College
]
]

.center[
&lt;img src="images/julia.png" width="11%" style="display: block; margin: auto;" /&gt;
Julia Silge  
RStudio
]

---

class: middle, inverse

## .larger[.dark-blue[.hand[Hello tidymodels]]]

---

class: middle

# High level view: tidymodels

---

class: middle

.pull-left[
&lt;img src="images/hello-tidymodels.png" width="100%" style="display: block; margin: auto;" /&gt;
]
.pull-right[
The **tidymodels** framework is a collection of packages for modeling and machine learning using tidyverse principles.


```r
install.packages("tidymodels")
```
]

---

.small[

```r
library(tidymodels)
```

```
## Registered S3 method overwritten by 'tune':
##   method                   from   
##   required_pkgs.model_spec parsnip
```

```
## ‚îÄ‚îÄ Attaching packages ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ tidymodels 0.1.3 ‚îÄ‚îÄ
```

```
## ‚úì broom        0.7.8      ‚úì rsample      0.1.0 
## ‚úì dials        0.0.9      ‚úì tune         0.1.5 
## ‚úì infer        0.5.4      ‚úì workflows    0.2.2 
## ‚úì modeldata    0.1.0      ‚úì workflowsets 0.0.2 
## ‚úì parsnip      0.1.6      ‚úì yardstick    0.0.8 
## ‚úì recipes      0.1.16
```

```
## ‚îÄ‚îÄ Conflicts ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ tidymodels_conflicts() ‚îÄ‚îÄ
## x recipes::check()   masks devtools::check()
## x scales::discard()  masks purrr::discard()
## x dplyr::filter()    masks stats::filter()
## x recipes::fixed()   masks stringr::fixed()
## x purrr::is_null()   masks testthat::is_null()
## x dplyr::lag()       masks stats::lag()
## x rsample::matches() masks dplyr::matches(), tidyr::matches(), testthat::matches()
## x yardstick::spec()  masks readr::spec()
## x recipes::step()    masks stats::step()
## ‚Ä¢ Use tidymodels_prefer() to resolve common conflicts.
```
]

---

&lt;img src="images/tidymodels.png" width="95%" style="display: block; margin: auto;" /&gt;

---

## Plan

1. First, let's talk about **syntax**
2. Then, a little bit on **motivation**
3. And finally **pedagogy**

---

class: middle

# Syntax

---

## Data: Paris Paintings

- Source: Printed catalogs of 28 auction sales in Paris, 1764 - 1780
- 3,393 paintings, their prices, and descriptive details from sales catalogs - over 60 variables


```r
pp &lt;- read_csv("data/paris-paintings.csv", na = c("n/a", "", "NA"))
pp
```

```
## # A tibble: 3,393 x 61
##   name     sale  lot   position dealer  year origin_author origin_cat
##   &lt;chr&gt;    &lt;chr&gt; &lt;chr&gt;    &lt;dbl&gt; &lt;chr&gt;  &lt;dbl&gt; &lt;chr&gt;         &lt;chr&gt;     
## 1 L1764-2  L1764 2       0.0328 L       1764 F             O         
## 2 L1764-3  L1764 3       0.0492 L       1764 I             O         
## 3 L1764-4  L1764 4       0.0656 L       1764 X             O         
## 4 L1764-5a L1764 5       0.0820 L       1764 F             O         
## 5 L1764-5b L1764 5       0.0820 L       1764 F             O         
## 6 L1764-6  L1764 6       0.0984 L       1764 X             O         
## # ‚Ä¶ with 3,387 more rows, and 53 more variables: school_pntg &lt;chr&gt;,
## #   diff_origin &lt;dbl&gt;, logprice &lt;dbl&gt;, price &lt;dbl&gt;, count &lt;dbl&gt;,
## #   subject &lt;chr&gt;, authorstandard &lt;chr&gt;, artistliving &lt;dbl&gt;,
...
```

---

## Observation: Depart pour la chasse

.pull-left[
&lt;img src="images/auction-catalogue.png" width="65%" style="display: block; margin: auto;" /&gt;
]
.pull-right[
&lt;img src="images/depart-pour-la-chasse.png" width="58%" style="display: block; margin: auto;" /&gt;
.small[
Two paintings very rich in composition, of a beautiful execution, and whose merit is very remarkable, each 17 inches 3 lines high, 23 inches wide; the first, painted on wood, comes from the Cabinet of Madame la Comtesse de Verrue; it represents a departure for the hunt: it shows in the front a child on a white horse, a man who gives the horn to gather the dogs, a falconer and other figures nicely distributed across the width of the painting; two horses drinking from a fountain; on the right in the corner a lovely country house topped by a terrace, on which people are at the table, others who play instruments; trees and fabriques pleasantly enrich the background.
]
]

---

## Observation: Depart pour la chasse


```r
pp %&gt;%
  filter(name == "R1777-89a") %&gt;%
  glimpse()
```

.small[
.pull-left[

```
## Rows: 1
## Columns: 61
## $ name              &lt;chr&gt; "R1777-89a"
## $ sale              &lt;chr&gt; "R1777"
## $ lot               &lt;chr&gt; "89"
## $ position          &lt;dbl&gt; 0.3755274
## $ dealer            &lt;chr&gt; "R"
## $ year              &lt;dbl&gt; 1777
## $ origin_author     &lt;chr&gt; "D/FL"
## $ origin_cat        &lt;chr&gt; "D/FL"
## $ school_pntg       &lt;chr&gt; "D/FL"
## $ diff_origin       &lt;dbl&gt; 0
## $ logprice          &lt;dbl&gt; 8.575462
## $ price             &lt;dbl&gt; 5300
## $ count             &lt;dbl&gt; 1
## $ subject           &lt;chr&gt; "D\u008epart pour la chasse"
## $ authorstandard    &lt;chr&gt; "Wouwerman, Philips"
## $ artistliving      &lt;dbl&gt; 0
## $ authorstyle       &lt;chr&gt; NA
## $ author            &lt;chr&gt; "Philippe Wouwermans"
## $ winningbidder     &lt;chr&gt; "Langlier, Jacques for Poullain, Antoine"
## $ winningbiddertype &lt;chr&gt; "DC"
## $ endbuyer          &lt;chr&gt; "C"
...
```
]
.pull-right[

```
...
## $ Interm            &lt;dbl&gt; 1
## $ type_intermed     &lt;chr&gt; "D"
## $ Height_in         &lt;dbl&gt; 17.25
## $ Width_in          &lt;dbl&gt; 23
## $ Surface_Rect      &lt;dbl&gt; 396.75
## $ Diam_in           &lt;dbl&gt; NA
## $ Surface_Rnd       &lt;dbl&gt; NA
## $ Shape             &lt;chr&gt; "squ_rect"
## $ Surface           &lt;dbl&gt; 396.75
## $ material          &lt;chr&gt; "bois"
## $ mat               &lt;chr&gt; "b"
## $ materialCat       &lt;chr&gt; "wood"
## $ quantity          &lt;dbl&gt; 1
## $ nfigures          &lt;dbl&gt; 0
## $ engraved          &lt;dbl&gt; 0
## $ original          &lt;dbl&gt; 0
## $ prevcoll          &lt;dbl&gt; 1
## $ othartist         &lt;dbl&gt; 0
## $ paired            &lt;dbl&gt; 1
## $ figures           &lt;dbl&gt; 0
## $ finished          &lt;dbl&gt; 0
...
```
]
]

---

## Linear regression, two ways

- **Goal:** Predict height of painting (`Height_in`) from width (`Width_in`)

- **Approach:**
  1. Using base R
  2. Using tidymodels

---

## Approach 1. Base R

- Fit:


```r
base_lm &lt;- lm(Height_in ~ Width_in, data = pp)
```

--

- Summarise:


```r
summary(base_lm)
```

```
...
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept) 3.621406   0.253860   14.27   &lt;2e-16 ***
## Width_in    0.780796   0.009505   82.15   &lt;2e-16 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
...
```

---

## Approach 2. Tidymodels

- Fit:


```r
tidy_lm &lt;- linear_reg() %&gt;%
  set_engine("lm") %&gt;%
  fit(Height_in ~ Width_in, data = pp)
```

--

- Summarise:


```r
tidy(tidy_lm)
```

```
## # A tibble: 2 x 5
##   term        estimate std.error statistic  p.value
##   &lt;chr&gt;          &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;
## 1 (Intercept)    3.62    0.254        14.3 8.82e-45
## 2 Width_in       0.781   0.00950      82.1 0
```

---

class: middle

.hand[Let's rewind and redo, step-by-step, with tidymodels]

---

## Step 1: Specify model


```r
linear_reg()
```

```
## Linear Regression Model Specification (regression)
```

---

## Step 2: Set model fitting *engine*


```r
linear_reg() %&gt;%
  set_engine("lm") # lm: linear model
```

```
## Linear Regression Model Specification (regression)
## 
## Computational engine: lm
```

---

## Step 3: Fit model &amp; estimate parameters

... using **formula syntax**


```r
linear_reg() %&gt;%
  set_engine("lm") %&gt;%
  fit(Height_in ~ Width_in, data = pp)
```

```
## parsnip model object
## 
## Fit time:  3ms 
## 
## Call:
## stats::lm(formula = Height_in ~ Width_in, data = data)
## 
## Coefficients:
## (Intercept)     Width_in  
##      3.6214       0.7808
```

---

## Step 4: Summarise model output


```r
linear_reg() %&gt;%
  set_engine("lm") %&gt;%
  fit(Height_in ~ Width_in, data = pp) %&gt;%
  tidy()
```

```
## # A tibble: 2 x 5
##   term        estimate std.error statistic  p.value
##   &lt;chr&gt;          &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;
## 1 (Intercept)    3.62    0.254        14.3 8.82e-45
## 2 Width_in       0.781   0.00950      82.1 0
```

---

## Linear regression, two ways

### Side-by-side comparison

.pull-left[
Base R:

.small[

```r
lm(Height_in ~ Width_in, data = pp) %&gt;%
  summary()
```

```
## 
## Call:
## lm(formula = Height_in ~ Width_in, data = pp)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -86.714  -4.384  -2.422   3.169  85.084 
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept) 3.621406   0.253860   14.27   &lt;2e-16 ***
## Width_in    0.780796   0.009505   82.15   &lt;2e-16 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## Residual standard error: 8.304 on 3133 degrees of freedom
##   (258 observations deleted due to missingness)
## Multiple R-squared:  0.6829,	Adjusted R-squared:  0.6828 
## F-statistic:  6749 on 1 and 3133 DF,  p-value: &lt; 2.2e-16
```
]]

.pull-right[
Tidymodels:

.small[

```r
linear_reg() %&gt;%
  set_engine("lm") %&gt;%
  fit(Height_in ~ Width_in, data = pp) %&gt;%
  tidy()
```

```
## # A tibble: 2 x 5
##   term        estimate std.error statistic  p.value
##   &lt;chr&gt;          &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;
## 1 (Intercept)    3.62    0.254        14.3 8.82e-45
## 2 Width_in       0.781   0.00950      82.1 0
```
]]

---

## A note on summarising model output

- Models fit with base R can be summarised with `tidy()` as well
- So you don't have to use the full tidymodels pipeline to benefit from the *tidy* output

.pull-left[
Base R:

.small[

```r
lm(Height_in ~ Width_in, data = pp) %&gt;%
  tidy()
```

```
## # A tibble: 2 x 5
##   term        estimate std.error statistic  p.value
##   &lt;chr&gt;          &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;
## 1 (Intercept)    3.62    0.254        14.3 8.82e-45
## 2 Width_in       0.781   0.00950      82.1 0
```
]]

.pull-right[
Tidymodels:

.small[

```r
linear_reg() %&gt;%
  set_engine("lm") %&gt;%
  fit(Height_in ~ Width_in, data = pp) %&gt;%
  tidy()
```

```
## # A tibble: 2 x 5
##   term        estimate std.error statistic  p.value
##   &lt;chr&gt;          &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;
## 1 (Intercept)    3.62    0.254        14.3 8.82e-45
## 2 Width_in       0.781   0.00950      82.1 0
```
]]

---

## Tidy regression output

Achieved with functions from the `broom` package:

- `tidy`: Constructs a data frame that summarizes the model's statistical findings: coefficient estimates, *standard errors, test statistics, p-values*.

- `glance`: Constructs a concise one-row summary of the model. This typically contains values such as `\(R^2\)`, adjusted `\(R^2\)`, *and residual standard errors that are computed once for the entire model*.

- `augment`: Adds columns to the original data that was modeled. This includes predictions and residuals.

---

## Comparison: `glance()`

**They're the same!**

.pull-left[
Base R fit + `glance()`:

.small[

```r
glance(base_lm)
```

```
## # A tibble: 1 x 12
##   r.squared adj.r.squared sigma statistic p.value    df  logLik    AIC    BIC
##       &lt;dbl&gt;         &lt;dbl&gt; &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;
## 1     0.683         0.683  8.30     6749.       0     1 -11083. 22173. 22191.
## # ‚Ä¶ with 3 more variables: deviance &lt;dbl&gt;, df.residual &lt;int&gt;, nobs &lt;int&gt;
```

```r
glance(base_lm)$r.squared
```

```
## [1] 0.6829468
```
]]

.pull-right[
Tidymodels fit + `glance()`:

.small[

```r
glance(tidy_lm)
```

```
## # A tibble: 1 x 12
##   r.squared adj.r.squared sigma statistic p.value    df  logLik    AIC    BIC
##       &lt;dbl&gt;         &lt;dbl&gt; &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;
## 1     0.683         0.683  8.30     6749.       0     1 -11083. 22173. 22191.
## # ‚Ä¶ with 3 more variables: deviance &lt;dbl&gt;, df.residual &lt;int&gt;, nobs &lt;int&gt;
```

```r
glance(tidy_lm)$r.squared
```

```
## [1] 0.6829468
```
]]

---

## Comparison: `augment()`

**They're not exactly the same!**

.pull-left[
Base R fit + `glance()`:

.small[

```r
base_lm_aug &lt;- augment(base_lm)
base_lm_aug
```

```
## # A tibble: 3,135 x 9
##   .rownames Height_in Width_in .fitted .resid     .hat .sigma   .cooksd
##   &lt;chr&gt;         &lt;dbl&gt;    &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;    &lt;dbl&gt;  &lt;dbl&gt;     &lt;dbl&gt;
## 1 1                37     29.5    26.7  10.3  0.000399   8.30 0.000310 
## 2 2                18     14      14.6   3.45 0.000396   8.31 0.0000342
## 3 3                13     16      16.1  -3.11 0.000361   8.31 0.0000254
## 4 4                14     18      17.7  -3.68 0.000337   8.31 0.0000330
## 5 5                14     18      17.7  -3.68 0.000337   8.31 0.0000330
## 6 6                 7     10      11.4  -4.43 0.000498   8.31 0.0000709
## # ‚Ä¶ with 3,129 more rows, and 1 more variable: .std.resid &lt;dbl&gt;
```
]]

.pull-right[
Tidymodels fit + `augment()`:

.small[

```r
tidy_lm_aug &lt;- augment(tidy_lm$fit)
tidy_lm_aug
```

```
## # A tibble: 3,135 x 9
##   .rownames Height_in Width_in .fitted .resid     .hat .sigma   .cooksd
##   &lt;chr&gt;         &lt;dbl&gt;    &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;    &lt;dbl&gt;  &lt;dbl&gt;     &lt;dbl&gt;
## 1 1                37     29.5    26.7  10.3  0.000399   8.30 0.000310 
## 2 2                18     14      14.6   3.45 0.000396   8.31 0.0000342
## 3 3                13     16      16.1  -3.11 0.000361   8.31 0.0000254
## 4 4                14     18      17.7  -3.68 0.000337   8.31 0.0000330
## 5 5                14     18      17.7  -3.68 0.000337   8.31 0.0000330
## 6 6                 7     10      11.4  -4.43 0.000498   8.31 0.0000709
## # ‚Ä¶ with 3,129 more rows, and 1 more variable: .std.resid &lt;dbl&gt;
```
]]

---

class: middle

# Motivation

---

## Provide similar interfaces to models

- Q: How do you define the the number of trees when fitting a random forest model?

--
- A: Depends on the package: `randomForest::randomForest()` uses `ntree`, `ranger::ranger()` uses `num.trees`, Spark's `sparklyr::ml_random_forest()` uses `num_trees`.

--
- A, with tidymodels: 


```r
rf_mod &lt;- rand_forest(trees = 2000)
```

---

## Help users avoid pitfalls

&lt;br&gt;

&gt; *"Many models, especially complex predictive or machine learning models, can work very well on the data at hand but may fail when exposed to new data. Often, this issue is due to poor choices made during the development and/or selection of the models. Whenever possible, [tidymodels] software, documentation, and other materials attempt to prevent these and other pitfalls."* [[Source](https://www.tmwr.org/index.html)]

&lt;br&gt;

--
- Tidymodels pipelines start with splitting data into training and testing sets, and facilitate keeping them separate
- Tidymodels is opiniated about which functions can be applied to testing data

---

class: middle

# Pedagogy

---

## For simple `lm`, might hard to see the advantage

.pull-left[
Base R:

.small[

```r
lm(Height_in ~ Width_in, data = pp) %&gt;%
  summary()
```

```
## 
## Call:
## lm(formula = Height_in ~ Width_in, data = pp)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -86.714  -4.384  -2.422   3.169  85.084 
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept) 3.621406   0.253860   14.27   &lt;2e-16 ***
## Width_in    0.780796   0.009505   82.15   &lt;2e-16 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## Residual standard error: 8.304 on 3133 degrees of freedom
##   (258 observations deleted due to missingness)
## Multiple R-squared:  0.6829,	Adjusted R-squared:  0.6828 
## F-statistic:  6749 on 1 and 3133 DF,  p-value: &lt; 2.2e-16
```
]]

.pull-right[
Tidymodels:

.small[

```r
linear_reg() %&gt;%
  set_engine("lm") %&gt;%
  fit(Height_in ~ Width_in, data = pp) %&gt;%
  tidy()
```

```
## # A tibble: 2 x 5
##   term        estimate std.error statistic  p.value
##   &lt;chr&gt;          &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;
## 1 (Intercept)    3.62    0.254        14.3 8.82e-45
## 2 Width_in       0.781   0.00950      82.1 0
```
]]

---

## Though easier to see the advantage in the summary step

.pull-left[
Base R:

.small[

```r
lm(Height_in ~ Width_in, data = pp) %&gt;%
  tidy()
```

```
## # A tibble: 2 x 5
##   term        estimate std.error statistic  p.value
##   &lt;chr&gt;          &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;
## 1 (Intercept)    3.62    0.254        14.3 8.82e-45
## 2 Width_in       0.781   0.00950      82.1 0
```
]]

.pull-right[
Tidymodels:

.small[

```r
linear_reg() %&gt;%
  set_engine("lm") %&gt;%
  fit(Height_in ~ Width_in, data = pp) %&gt;%
  tidy()
```

```
## # A tibble: 2 x 5
##   term        estimate std.error statistic  p.value
##   &lt;chr&gt;          &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;
## 1 (Intercept)    3.62    0.254        14.3 8.82e-45
## 2 Width_in       0.781   0.00950      82.1 0
```
]]

---

## Pedagogical advantages more clear as you move on to different models

.pull-left[

```r
linear_reg() %&gt;%
  set_engine("lm") %&gt;%
  set_mode("regression")

logistic_reg() %&gt;% 
  set_engine("glm") %&gt;%
  set_mode("classification")

rand_forest() %&gt;% 
  set_engine("ranger") %&gt;% 
  set_mode("regression")

decision_tree() %&gt;% 
  set_engine("rpart") %&gt;% 
  set_mode("regression")

...
```
]

--
.pull-right[

```r
svm_linear() %&gt;% 
  set_engine("LiblineaR") %&gt;% 
  set_mode("regression") 
```

```
## Linear Support Vector Machine Specification (regression)
## 
## Computational engine: LiblineaR
```

```r
svm_linear() %&gt;% 
  set_engine("LiblineaR") %&gt;% 
  set_mode("classification")
```

```
## Linear Support Vector Machine Specification (classification)
## 
## Computational engine: LiblineaR
```
]

---

## Build on dplyr pipelines to build recipes

.pull-left[

```r
email %&gt;%
  select(-from, -sent_email) %&gt;%
  mutate(
    day_of_week = lubridate::wday(time),
    month = lubridate::month(time)
  ) %&gt;%
  select(-time) %&gt;%
  mutate(
    cc = cut(cc, breaks = c(0, 1)),
    attach = cut(attach, breaks = c(0, 1)),
    dollar = cut(dollar, breaks = c(0, 1))
  ) %&gt;%
  mutate(
    inherit = cut(inherit, breaks = c(0, 1, 5, 10, 20)),
    password = cut(password, breaks = c(0, 1, 5, 10, 20))
  ) %&gt;%
  ...
```
]

--
.pull-right[

```r
recipe(spam ~ ., data = email) %&gt;%
  step_rm(from, sent_email) %&gt;%
  step_date(
    time, 
    features = c("dow", "month")
    ) %&gt;%
  step_rm(time) %&gt;%
  step_cut(
    cc, 
    attach, 
    dollar, breaks = c(0, 1)
    ) %&gt;%
  step_cut(
    inherit, 
    password, breaks = c(0, 1, 5, 10, 20)
    ) %&gt;%
  ...
```
]

---

class: middle, inverse

## .larger[.dark-blue[.hand[Case studies]]]

---

class: middle

# Case study 1: Linear, simple...

---

MLR example without recipes

- fit model
- prediction
- breakout room: 10 min
		
---

class: middle

# Case study 2: Logistic, more complex...

---

cross validation, autoplot

---

class: middle, inverse

## .larger[.dark-blue[.hand[Wrap up]]]

---

class: middle

# What about inference?

---

## Suppose...

Estimate the difference between the average evaluation score of male and female faculty.

.midi[

```r
library(openintro)
evals %&gt;%
  select(score, rank, ethnicity, gender, bty_avg)
```

```
## # A tibble: 463 x 5
##   score rank         ethnicity    gender bty_avg
##   &lt;dbl&gt; &lt;fct&gt;        &lt;fct&gt;        &lt;fct&gt;    &lt;dbl&gt;
## 1   4.7 tenure track minority     female       5
## 2   4.1 tenure track minority     female       5
## 3   3.9 tenure track minority     female       5
## 4   4.8 tenure track minority     female       5
## 5   4.6 tenured      not minority male         3
## 6   4.3 tenured      not minority male         3
## # ‚Ä¶ with 457 more rows
```
]

---

.pull-left[
.midi[

```r
evals %&gt;%
  specify(score ~ gender) %&gt;%
  generate(reps = 1000, 
    type = "bootstrap") %&gt;%
  calculate(stat = "diff in means", 
    order = c("male", "female")) %&gt;%
  summarise(
    l = quantile(stat, 0.025), 
    u = quantile(stat, 0.975)
    )
```

```
## # A tibble: 1 x 2
##        l     u
##    &lt;dbl&gt; &lt;dbl&gt;
## 1 0.0342 0.244
```
]
]
.pull-right[
.midi[

```r
t.test(evals$score ~ evals$gender)
```

```
## 
## 	Welch Two Sample t-test
## 
## data:  evals$score by evals$gender
## t = -2.7507, df = 398.7, p-value = 0.006218
## alternative hypothesis: true difference in means between group female and group male is not equal to 0
## 95 percent confidence interval:
##  -0.24264375 -0.04037194
## sample estimates:
## mean in group female   mean in group male 
##             4.092821             4.234328
```
]
]

---

## infer `\(\in\)` tidymodels

.pull-left[
The objective of **infer** is to perform statistical inference using an expressive statistical grammar that coheres with the tidyverse design framework.
]
.pull-right[
&lt;img src="images/infer.png" title="Hex sticker for the infer package." alt="Hex sticker for the infer package." width="60%" style="display: block; margin: auto;" /&gt;
]

---

.midi[

```r
evals %&gt;%
  specify(score ~ gender)
```

```
## Response: score (numeric)
## Explanatory: gender (factor)
## # A tibble: 463 x 2
##   score gender
##   &lt;dbl&gt; &lt;fct&gt; 
## 1   4.7 female
## 2   4.1 female
## 3   3.9 female
## 4   4.8 female
## 5   4.6 male  
## 6   4.3 male  
## # ‚Ä¶ with 457 more rows
```
]

---

.midi[

```r
set.seed(1234)
evals %&gt;%
  specify(score ~ gender) %&gt;%
  generate(reps = 1000, type = "bootstrap")
```

```
## Response: score (numeric)
## Explanatory: gender (factor)
## # A tibble: 463,000 x 3
## # Groups:   replicate [1,000]
##   replicate score gender
##       &lt;int&gt; &lt;dbl&gt; &lt;fct&gt; 
## 1         1   4   female
## 2         1   3.1 male  
## 3         1   5   male  
## 4         1   4.4 male  
## 5         1   3.5 female
## 6         1   4.5 female
## # ‚Ä¶ with 462,994 more rows
```
]

---

.midi[

```r
set.seed(1234)
evals %&gt;%
  specify(score ~ gender) %&gt;%
  generate(reps = 1000, type = "bootstrap") %&gt;%
  calculate(stat = "diff in means", order = c("male", "female"))
```

```
## # A tibble: 1,000 x 2
##   replicate  stat
##       &lt;int&gt; &lt;dbl&gt;
## 1         1 0.230
## 2         2 0.134
## 3         3 0.100
## 4         4 0.230
## 5         5 0.128
## 6         6 0.201
## # ‚Ä¶ with 994 more rows
```
]

---

.midi[

```r
set.seed(1234)
evals %&gt;%
  specify(score ~ gender) %&gt;%
  generate(reps = 1000, type = "bootstrap") %&gt;%
  calculate(stat = "diff in means", order = c("male", "female")) %&gt;%
  visualise()
```

&lt;img src="tidy-up-models_files/figure-html/infer-4-1.png" width="60%" style="display: block; margin: auto;" /&gt;
]

---

.midi[

```r
set.seed(1234)
evals %&gt;%
  specify(score ~ gender) %&gt;%
  generate(reps = 1000, type = "bootstrap") %&gt;%
  calculate(stat = "diff in means", order = c("male", "female")) %&gt;%
  summarise(l = quantile(stat, 0.025), u = quantile(stat, 0.975))
```

```
## # A tibble: 1 x 2
##        l     u
##    &lt;dbl&gt; &lt;dbl&gt;
## 1 0.0407 0.236
```
]

---

## Learning resources

.large[
üèÅ **Get started** with tidymodels: [tidymodels.org/start](https://www.tidymodels.org/start/)

üìÑ **Learn** more and go further: [tidymodels.org/learn](https://www.tidymodels.org/learn/)

üìò **Tidy Modeling with R** by Max Kuhn &amp; Julia Silge: [tmwr.org](https://www.tmwr.org/)
]

---

## Teaching resources

**Data Science in a Box** (datasciencebox.org](https://datasciencebox.org/)) contains slides, application exercises, computing labs, and homework assignments on modelling and inference with tidymodels:

.midi[
- Slides and application exercises:
  - [Modelling data](https://datasciencebox.org/making-rigorous-conclusions.html#modelling-data)
  - [Classification and model building](https://datasciencebox.org/making-rigorous-conclusions.html#classification-and-model-building)
  - [Model validation](https://datasciencebox.org/making-rigorous-conclusions.html#model-validation)
  - [Uncertainty quantification](https://datasciencebox.org/making-rigorous-conclusions.html#uncertainty-quantification)
- [Labs](https://datasciencebox.org/making-rigorous-conclusions.html#labs-2)
  - Grading the professor: Fitting and interpreting simple linear regression models
  - Smoking while pregnant: Constructing confidence intervals, conducting hypothesis tests, and interpreting results in context of the data
- [Homework assignments](https://datasciencebox.org/making-rigorous-conclusions.html#homework-assignments-1):
  - Bike rentals in DC: Exploratory data analysis and fitting and interpreting models
  - Exploring the GSS: Fitting and interpreting models
  - Modelling the GSS: Model validation and inference
]

---

class: center, middle

.huge[
.hand[thank you!]
]

.large[
üîó [bit.ly/tidymodels-uscots21](https://bit.ly/tidymodels-uscots21)
]
    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"ratio": "16:9",
"highlightLines": true,
"highlightStyle": "solarized-light",
"countIncrementalSlides": false
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
